"""
–ú–æ–¥—É–ª—å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã —Å –ø–æ–º–æ—â—å—é —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–∞–∫–µ—Ç–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤.

–§—É–Ω–∫—Ü–∏–∏:
- upgrade_system(): –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–∞–∫–µ—Ç—ã —Å–∏—Å—Ç–µ–º—ã.
"""

from .utils import run_command, detect_package_managers
from .colors import color_text  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º color_text


def upgrade_system():
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã —Å –ø–æ–º–æ—â—å—é –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∞–∫–µ—Ç–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤.

    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫–∏–µ –ø–∞–∫–µ—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ,
    –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤.

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        None
    """
    package_managers = detect_package_managers()

    if not package_managers:
        print(
            color_text("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞–∫–µ—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã.", "red")
        )
        return

    # –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å –∏—Ö –∫–æ–º–∞–Ω–¥–∞–º–∏
    upgrade_commands = {
        "epm": [["sudo", "epm", "full-upgrade"]],
        "flatpak": [["flatpak", "update"]],
        "snap": [["sudo", "snap", "refresh"]],
        "paru": [["paru", "-Syu"]],
        "yay": [["yay", "-Syu"]],
        "dnf": [["sudo", "dnf", "upgrade"]],
        "pacman": [["sudo", "pacman", "-Syu", "--noconfirm"]],
        "apk": [["sudo", "apk", "upgrade"]],
        "xbps": [["sudo", "xbps-install", "-Su"]],
        "apt": [["sudo", "apt", "full-upgrade"]],
        "apt-get": [["sudo", "apt-get", "dist-upgrade"]],
    }

    for manager in package_managers:
        if manager in upgrade_commands:
            try:
                print(
                    color_text(
                        f"üîÑ –û–±–Ω–æ–≤–ª—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã —Å –ø–æ–º–æ—â—å—é {manager}...",
                        "magenta",
                    )
                )
                for command in upgrade_commands[manager]:
                    run_command(command)
                print(
                    color_text(
                        f"üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ –¥–ª—è {manager}!\n",
                        "green",
                    )
                )
            except RuntimeError as e:
                print(
                    color_text(
                        f"\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è {manager}: {e}", "red"
                    )
                )
        else:
            print(color_text(f"\n‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä: {manager}", "red"))
